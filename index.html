<!DOCTYPE HTML>
<html>
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    </head>
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>  
	
    <body style='margin : 0px; overflow: hidden;'>
        <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false; patternRatio:0.90'>

        <a-assets>
            <a-asset-item id="mail" src="Assets\Models\mail.glb"></a-asset-item>
            <a-asset-item id="mob" src="Assets\Models\Phone.glb"></a-asset-item>
            <a-asset-item id="web" src="Assets\Models\web.glb"></a-asset-item>
            <a-asset-item id="map" src="Assets\Models\maps.glb"></a-asset-item>
            <video preload="none" id="video" response-type="arraybuffer" loop="false" crossorigin webkit-playsinline playsinline controls>
                <source  src="Assets\videoplayback.mp4">
            </video>
        </a-assets>

    <a-marker markerhandler emitevents="true" cursor="rayOrigin: mouse" id="animated-marker" preset="custom" type="pattern" url="Assets\Patt\pattern-mail.patt">
        <a-entity 
                      gltf-model="#mail" 
                      id="MailPress" 
                      scale="0.015 0.015 0.015" 
                      rotation="0 0 0">
        </a-entity>       
    </a-marker>
	
    <a-marker mobhandler emitevents="true" cursor="rayOrigin: mouse" id="mob-marker" preset="custom" type="pattern" url="Assets\Patt\pattern-Mobile.patt">
        <a-entity 
                      gltf-model="#mob" 
                      id="MobPress" 
                      scale="0.015 0.015 0.015" 
                      rotation="0 0 0">
        </a-entity>       
    </a-marker>

    <a-marker maphandler emitevents="true" cursor="rayOrigin: mouse" id="map-marker" preset="custom" type="pattern" url="Assets\Patt\pattern-Maps.patt">
        <a-entity 
                      gltf-model="#map" 
                      id="MapPress" 
                      scale="0.015 0.015 0.015" 
                      rotation="0 0 0">
        </a-entity>       
    </a-marker>

	<a-marker vidhandler emitevents="true" cursor="rayOrigin: mouse" id="vid-marker" preset="custom" type="pattern" url="Assets\Patt\pattern-PRINT.patt">
        <a-video src="#video" width="2" height="1" rotation="270 0 0" autoplay="true"></a-video>
	</a-marker>	
		
	<!--<a-marker pichandler emitevents="true" cursor="rayOrigin: mouse" id="pic-marker" raycaster="objects: .clickable" preset="custom" type="pattern" url="patterns\pattern-Maps.patt">
		<a-image 
			 src="Assets\aishwariya-mahal.jpg" 
			 id="PhotoPress" 
			 rotation="270 0 0"
             class="clickable">
		</a-image>
	</a-marker>	-->
        
    </a-marker>
        <a-entity camera></a-entity>
        </a-scene>
	  
    <!--<script src="events.js"></script>-->
	<script>
		AFRAME.registerComponent('markerhandler', {

    init: function() {
        var clicks = false;
        const animatedMarker = document.querySelector("#animated-marker");
        const aEntity = document.querySelector("#MailPress");
        document.querySelector("#animated-marker").addEventListener('markerFound', (evt) => {
                clicks = true
            })
        document.querySelector("#animated-marker").addEventListener('markerLost', (evt) => {
                clicks = false
            }) 
        
        animatedMarker.addEventListener('click', function(ev, target){
            const intersectedElement = ev && ev.detail && ev.detail.intersectedEl;
            if (aEntity && intersectedElement === aEntity) {
                console.log("Mail:"+clicks);
                if(clicks) {
                    window.location.href="mailto:hodprinting@annauniv.edu";
                }
            }
        });
}});

AFRAME.registerComponent('mobhandler', {

    init: function() {
        var mclicks = false;
        const mobMarker = document.querySelector("#mob-marker");
        const bEntity = document.querySelector("#MobPress");
        document.querySelector("#mob-marker").addEventListener('markerFound', (evt) => {
                mclicks = true
            })
        document.querySelector("#mob-marker").addEventListener('markerLost', (evt) => {
                mclicks = false
            }) 
        
        mobMarker.addEventListener('click', function(ev, target){
            const intersectedElement = ev && ev.detail && ev.detail.intersectedEl;
            if (bEntity && intersectedElement === bEntity) {
                console.log("Mob:"+mclicks);
                if(mclicks) {
                    window.location.href="tel:04422358957";
                }
            }
        });
}});

AFRAME.registerComponent('maphandler', {

    init: function() {
        var pclicks = false;
        const mapMarker = document.querySelector("#map-marker");
        const cEntity = document.querySelector("#MapPress");
        document.querySelector("#map-marker").addEventListener('markerFound', (evt) => {
                pclicks = true
            })
        document.querySelector("#map-marker").addEventListener('markerLost', (evt) => {
                pclicks = false
            }) 
        
        mapMarker.addEventListener('click', function(ev, target){
            const intersectedElement = ev && ev.detail && ev.detail.intersectedEl;
            if (cEntity && intersectedElement === cEntity) {
                console.log("Map:"+pclicks);
                if(pclicks) {
                    window.location.href="https://goo.gl/maps/GNpCM9bwkJcxz9n36";
                }
            }
        });
}});

AFRAME.registerComponent('vidhandler', {
  
   		 init: function () {
       		 this.toggle = false;
       		 this.vid = document.querySelector("#video")
       		 this.vid.pause();
   		 },
   		 tick: function () {
      		  if (this.el.object3D.visible == true) {
            		if (!this.toggle) {
               		  this.toggle = true;
              		  this.vid.play();
          		  }
       			 } else {
           		 this.toggle = false;
            		 this.vid.pause();
        		}
    		}
	});
	</script>
	
    </body>
</html>
